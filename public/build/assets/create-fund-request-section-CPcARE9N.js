import{a as L,r as u,j as e}from"./app-CveY-weV.js";import{u as E,C as O}from"./index.esm-D_O8Rlo4.js";import{d as x,D as T}from"./index-umIXXred.js";import{h as V}from"./moment-G82_0lEo.js";import{s as B}from"./open-ai-service-wVb0p-YH.js";import{S as P}from"./swal-C3f9_lRM.js";import{B as R}from"./button-CmXuo8Ul.js";import{M as k}from"./modal-VyEkX-Gx.js";import{I as h}from"./input-BSJYTUEW.js";import{S as z}from"./index-klG88YQy.js";import{U as A}from"./index-CSxv0-_f.js";import{R as G}from"./InboxOutlined-DNyrUZYA.js";async function H(n){try{return await L.post("/api/accounting_expenses",n)}catch{}}async function oe(){try{return await L.get("/api/accounting_expenses")}catch{}}const{Dragger:J}=A;function K(){var S,_,y;const[n,o]=u.useState(!1),[M,l]=u.useState(!1),[d,c]=u.useState(!1),{register:f,handleSubmit:Y,control:j,formState:{errors:t,isSubmitting:b},reset:U,setValue:p}=E({defaultValues:{description:"",receipt_number:"",amount:"",balance:"",files:[],date:x()}});async function v(s){const a=new FormData;Object.entries(s).forEach(([r,i])=>{if(r==="files"&&(i!=null&&i.length)){const m=i[0];a.append("file",m.originFileObj)}else r==="date"?a.append("date",V(i.toISOString()).format("LLL")):a.append(r,i??"")});try{await H(a),l(!1),await P({type:"success"}),U(),o(!1)}catch(r){l(!1),console.error("Submit error:",r)}}async function I(s,a){var D;c(!0);const r=s.fileList.slice(-1),i=new FormData,m=(D=r[0])==null?void 0:D.originFileObj;if(m){i.append("receipt",m);try{const g=await B(i),{receipt_number:w,amount:C,date:F,description:N}=g.data.result;if(w&&p("receipt_number",w),C&&p("amount",C),N&&p("description",N),F){const q=x(F,["MM/DD/YYYY","YYYY-MM-DD"]);q.isValid()&&p("date",q)}a.onChange(r),l(!0),c(!1)}catch(g){l(!0),c(!1),console.error("Scan error:",g)}}}return u.useEffect(()=>{n&&l(!1)},[n]),e.jsxs(e.Fragment,{children:[e.jsx(R,{onClick:()=>o(!0),children:"Create Fund Request"}),e.jsx(k,{width:"max-w-xl",isOpen:n,onClose:o,title:"Create Fund Request",children:e.jsxs("form",{onSubmit:Y(v),className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[!d&&M&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(O,{control:j,name:"date",rules:{required:"Please select a date"},render:({field:s})=>e.jsx(T,{size:"large",className:"w-full border py-2.5 border-gray-900",onChange:s.onChange,value:s.value,disabledDate:a=>a&&a<x().startOf("day")})}),(t==null?void 0:t.date)&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.date.message}),e.jsx(h,{label:"Description",type:"text",name:"description",error:(S=t==null?void 0:t.description)==null?void 0:S.message,register:f("description",{required:"This field is required"})}),e.jsx(h,{label:"Receipt Number",type:"text",name:"receipt_number",error:(_=t==null?void 0:t.receipt_number)==null?void 0:_.message,register:f("receipt_number",{required:"This field is required"})}),e.jsx(h,{label:"Amount",type:"number",name:"amount",error:(y=t==null?void 0:t.amount)==null?void 0:y.message,register:f("amount",{required:"This field is required"})})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs(z,{spinning:d,tip:"Scanning...",children:[e.jsx(O,{name:"files",control:j,defaultValue:[],rules:{validate:s=>!s||s.length<=1||"Only one file allowed"},render:({field:s})=>e.jsxs(J,{accept:".pdf,.jpg,.jpeg,.png",height:150,beforeUpload:()=>!1,multiple:!1,onChange:a=>{const r=a.fileList.slice(-1);c(!0),I({...a,fileList:r},s).finally(()=>{c(!1)})},fileList:s.value||[],children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(G,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag receipt to this area to upload"})]})}),(t==null?void 0:t.files)&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.files.message})]})})]})}),e.jsx(R,{type:"submit",loading:b||d,disabled:b||d,children:"SUBMIT REFUND"})]})})]})}const le=Object.freeze(Object.defineProperty({__proto__:null,default:K},Symbol.toStringTag,{value:"Module"}));export{K as C,le as c,oe as g};
