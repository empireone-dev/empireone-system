import{r as d,j as e,s as E}from"./app-CUepSACY.js";import{u as v,C as R}from"./index.esm-D1e0TRwU.js";import{d as g,D as T}from"./index-D__2K_iR.js";import{h as V}from"./moment-G82_0lEo.js";import{s as k}from"./open-ai-service-BgyNc4-M.js";import{S as B}from"./swal-DBVQrojd.js";import{B as L}from"./button-CCq3Y93h.js";import{M as A}from"./modal-CO5JXobI.js";import{I as h}from"./input-DrnlYYNG.js";import{c as P,b as z}from"./accounting-thunk-Bqj2HOIB.js";import{S as G}from"./index-DRrtoEU1.js";import{U as H}from"./index-B5D6-txo.js";import{R as J}from"./InboxOutlined-DhNjPqno.js";import"./index-CUhN4U1u.js";import"./index-P0PFwaZV.js";import"./index-0WUxril7.js";import"./index-BsYcV8eh.js";import"./sweetalert2.esm.all-EtYCW2yB.js";import"./transition-DAc5LZ3Y.js";import"./index-W-kyyt19.js";import"./zoom-CPbcI7F0.js";import"./colors-D-pynnaa.js";import"./EyeOutlined-CifvzgBh.js";const{Dragger:K}=H;function je(){var S,_,y;const[p,f]=d.useState(!1),[O,n]=d.useState(!1),[l,o]=d.useState(!1),{register:u,handleSubmit:Y,control:j,formState:{errors:t,isSubmitting:b},reset:M,setValue:c}=v({defaultValues:{description:"",receipt_number:"",amount:"",balance:"",files:[],date:g()}});async function U(s){const a=new FormData;Object.entries(s).forEach(([i,r])=>{if(i==="files"&&(r!=null&&r.length)){const m=r[0];a.append("file",m.originFileObj)}else i==="date"?a.append("date",V(r.toISOString()).format("LLL")):a.append(i,r??"")});try{await P(a),await E.dispatch(z()),n(!1),await B({type:"success"}),M(),f(!1)}catch(i){n(!1),console.error("Submit error:",i)}}async function I(s,a){var D;o(!0);const i=s.fileList.slice(-1),r=new FormData,m=(D=i[0])==null?void 0:D.originFileObj;if(m){r.append("receipt",m);try{const x=await k(r),{receipt_number:w,amount:N,date:q,description:C}=x.data.result;if(w&&c("receipt_number",w),N&&c("amount",N),C&&c("description",C),q){const F=g(q,["MM/DD/YYYY","YYYY-MM-DD"]);F.isValid()&&c("date",F)}a.onChange(i),n(!0),o(!1)}catch(x){n(!0),o(!1),console.error("Scan error:",x)}}}return d.useEffect(()=>{p&&n(!1)},[p]),e.jsxs(e.Fragment,{children:[e.jsx(L,{onClick:()=>f(!0),children:"Request Refund"}),e.jsx(A,{width:"max-w-xl",isOpen:p,onClose:f,title:"Create Fund Request",children:e.jsxs("form",{onSubmit:Y(U),className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex gap-4",children:e.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[!l&&O&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(R,{control:j,name:"date",rules:{required:"Please select a date"},render:({field:s})=>e.jsx(T,{size:"large",className:"w-full border py-2.5 border-gray-900",onChange:s.onChange,value:s.value,disabledDate:a=>a&&a<g().startOf("day")})}),(t==null?void 0:t.date)&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.date.message}),e.jsx(h,{label:"Description",type:"text",name:"description",error:(S=t==null?void 0:t.description)==null?void 0:S.message,register:u("description",{required:"This field is required"})}),e.jsx(h,{label:"Receipt Number",type:"text",name:"receipt_number",error:(_=t==null?void 0:t.receipt_number)==null?void 0:_.message,register:u("receipt_number",{required:"This field is required"})}),e.jsx(h,{label:"Amount",type:"number",name:"amount",error:(y=t==null?void 0:t.amount)==null?void 0:y.message,register:u("amount",{required:"This field is required"})})]}),e.jsx("div",{className:"overflow-auto",children:e.jsxs(G,{spinning:l,tip:"Scanning...",children:[e.jsx(R,{name:"files",control:j,defaultValue:[],rules:{validate:s=>!s||s.length<=1||"Only one file allowed"},render:({field:s})=>e.jsxs(K,{accept:".pdf,.jpg,.jpeg,.png",height:150,beforeUpload:()=>!1,multiple:!1,onChange:a=>{const i=a.fileList.slice(-1);o(!0),I({...a,fileList:i},s).finally(()=>{o(!1)})},fileList:s.value||[],children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(J,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag receipt to this area to upload"})]})}),(t==null?void 0:t.files)&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:t.files.message})]})})]})}),e.jsx(L,{type:"submit",loading:b||l,disabled:b||l,children:"SUBMIT REFUND"})]})})]})}export{je as default};
