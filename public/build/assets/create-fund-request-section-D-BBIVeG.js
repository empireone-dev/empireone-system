import{r as b,u as F,j as e}from"./app-C11SRzzF.js";import{u as C,C as w}from"./index.esm-BR5-hCoq.js";import{d as m}from"./dayjs.min-TmqVXa-R.js";import{h as p}from"./moment-G82_0lEo.js";import{S as L}from"./swal-BjvTUYlq.js";import{B as d}from"./button-DxsrpKon.js";import{M as N}from"./modal-Dbtk_sxx.js";import{s as O}from"./open-ai-service-CYJtEeoO.js";import{U as D}from"./index-CdmCKIEr.js";import{R}from"./InboxOutlined-D2iaiCX8.js";import"./sweetalert2.esm.all-EtYCW2yB.js";import"./index-Bn47VSBn.js";import"./transition-CjmAaxEq.js";import"./roundedArrow-OcSXYK2T.js";import"./index-lECfjvoJ.js";import"./index-B2e_8HKt.js";const{Dragger:y}=D;function Q(){const[f,l]=b.useState(!1),{sites:U}=F(t=>t.sites),{register:_,handleSubmit:u,control:x,formState:{errors:n,isSubmitting:c},reset:g}=C({defaultValues:{description:"",receipt_number:"",amount:"",balance:"",files:[],date:[m(),m().add(3,"day")]}});async function h(t){const s=new FormData,[a,r]=t.date||[];Object.entries(t).forEach(([o,i])=>{if(o!=="date")if(o==="files"&&(i!=null&&i.length)){const S=i[0];s.append("files[0]",S.originFileObj)}else s.append(o,i??"")}),s.append("start",a?p(a.toISOString()).format("LLL"):""),s.append("end",r?p(r.toISOString()).format("LLL"):"");try{await L({type:"success"}),g(),l(!1)}catch(o){console.error("Submit error:",o)}}async function j(t,s){const a=t.fileList.slice(-1);console.log("Latest file:",a[0]);const r=new FormData;r.append("receipt",a[0].originFileObj),await O(r),s.onChange(a)}return e.jsxs(e.Fragment,{children:[e.jsx(d,{onClick:()=>l(!0),children:"Create Fund Request"}),e.jsx(N,{width:"max-w-xl",isOpen:f,onClose:l,title:"Create Fund Request",children:e.jsxs("form",{onSubmit:u(h),className:"flex flex-col gap-4",children:[e.jsx("div",{className:"flex gap-4",children:e.jsx("div",{className:"flex-1 flex flex-col gap-4",children:e.jsxs("div",{className:"overflow-auto",children:[e.jsx(w,{name:"files",control:x,defaultValue:[],rules:{validate:t=>!t||t.length<=1||"Only one file allowed"},render:({field:t})=>e.jsxs(y,{accept:".pdf,.jpg,.jpeg,.png",height:150,beforeUpload:()=>!1,multiple:!1,onChange:s=>j(s,t),fileList:t.value||[],children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(R,{})}),e.jsx("p",{className:"ant-upload-text",children:"Click or drag receipt to this area to upload"})]})}),(n==null?void 0:n.files)&&e.jsx("p",{className:"text-sm text-red-600 mt-1",children:n.files.message})]})})}),e.jsx(d,{type:"submit",loading:c,disabled:c,children:"SUBMIT REFUND"})]})})]})}export{Q as default};
