import{r as U,u as C,j as t,s as d}from"./app-DzHQYGqW.js";import{u as I,C as c}from"./index.esm-ZoWVrAt7.js";import{d as p,D as O}from"./index-D6mG6VnS.js";import{B as q}from"./button-9647Amo6.js";import{M as R}from"./modal-DKa6ahTy.js";import{S as l}from"./select-Lcw4zzuR.js";import{I as E}from"./input-Dtjemc_G.js";import{W as M}from"./wysiwyg-DsTeBmpa.js";import{h as w}from"./moment-G82_0lEo.js";import{c as F,b as B}from"./ticket-thunk-DKazJcRB.js";import{d as A}from"./department-lib-CBKGVWYC.js";import{g as H}from"./categories-thunk-BL83tYMq.js";import{S as W}from"./swal-BXCo3BPs.js";import{U as z}from"./index-B1niR5ir.js";import{R as K}from"./InboxOutlined-AwJUh5oD.js";import"./index-YyO4l-xR.js";import"./index-BqmZQ817.js";import"./index-DTkmr0Bf.js";import"./index-Dsyer-8f.js";import"./transition-DBV0_3LV.js";import"./react-draft-wysiwyg-C02MXdrG.js";import"./sweetalert2.esm.all-EtYCW2yB.js";import"./index-B8u8T5HY.js";import"./zoom-BzZSFq9B.js";import"./colors-BZdDdyou.js";import"./EyeOutlined-DXfXbT8v.js";const{Dragger:V}=z,{RangePicker:$}=O;function ye(){var u,h,x,j,b;const[T,n]=U.useState(!1),{categories:g}=C(e=>e.categories),{sites:k}=C(e=>e.sites),{register:s,handleSubmit:v,control:m,formState:{errors:a,isSubmitting:f},reset:D}=I({defaultValues:{description:"",files:[],date_range:[p(),p().add(3,"day")]}});function L(e){d.dispatch(H({department:e}))}async function N(e){const i=new FormData,[y,_]=e.date_range||[];Object.entries(e).forEach(([r,o])=>{r!=="date_range"&&(r==="files"&&(o!=null&&o.length)?Array.from(o).forEach((S,P)=>{console.log("filefile",S),i.append(`files[${P}]`,S.originFileObj)}):i.append(r,o??""))}),i.append("start",y?w(y.toISOString()).format("LLL"):""),i.append("end",_?w(_.toISOString()).format("LLL"):"");try{await d.dispatch(F(i)),await d.dispatch(B()),await W({type:"success"}),D(),n(!1)}catch(r){console.error("Submit error:",r)}}return console.log("categories",g),t.jsxs(t.Fragment,{children:[t.jsx(q,{onClick:()=>n(!0),children:"Create Ticket"}),t.jsx(R,{width:"max-w-5xl",isOpen:T,onClose:n,title:"Create Ticket",children:t.jsxs("form",{onSubmit:v(N),className:"flex flex-col gap-4",children:[t.jsxs("div",{className:"flex gap-4",children:[t.jsxs("div",{className:"flex-1 flex flex-col gap-4",children:[t.jsx(l,{label:"Department",name:"department",options:A,error:(u=a==null?void 0:a.department)==null?void 0:u.message,register:s("department",{required:"This field is required"}),onChange:e=>L(e.target.value)}),t.jsx(l,{label:"Category",name:"category_id",options:g.map(e=>({label:e.name,value:e.id})),error:(h=a==null?void 0:a.category_id)==null?void 0:h.message,register:s("category_id",{required:"This field is required"})}),t.jsx(l,{label:"Site",name:"site_id",options:[...k].sort((e,i)=>e.name.localeCompare(i.name)).map(e=>({label:e.name,value:e.id})),error:(x=a==null?void 0:a.site_id)==null?void 0:x.message,register:s("site_id",{required:"This field is required"})}),t.jsx(l,{label:"Urgent Type",name:"isUrgent",options:[{label:"Low Priority",value:"Low Priority"},{label:"Medium Priority",value:"Medium Priority"},{label:"High Priority",value:"High Priority"}],error:(j=a==null?void 0:a.isUrgent)==null?void 0:j.message,register:s("isUrgent",{required:"This field is required"})}),t.jsx(E,{label:"Station/Room etc.",type:"text",name:"station",error:(b=a==null?void 0:a.station)==null?void 0:b.message,register:s("station",{required:"This field is required"})}),t.jsxs("div",{children:[t.jsx(c,{control:m,name:"date_range",rules:{required:"Please select a date range"},render:({field:e})=>t.jsx($,{size:"large",className:"w-full border border-gray-900",showTime:!0,onChange:e.onChange,value:e.value,disabledDate:i=>i&&i<p().startOf("day")})}),(a==null?void 0:a.date_range)&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.date_range.message})]})]}),t.jsxs("div",{className:"flex-1 flex flex-col",children:[t.jsx(c,{name:"details",control:m,rules:{required:"Details is required"},render:({field:e})=>{var i;return t.jsx(M,{label:"Details Request",value:e.value,onChange:e.onChange,error:(i=a==null?void 0:a.details)==null?void 0:i.message})}}),t.jsxs("div",{className:"overflow-auto",children:[t.jsx(c,{name:"files",control:m,...s("files",{}),render:({field:e})=>t.jsxs(V,{height:150,beforeUpload:()=>!1,multiple:!0,onChange:i=>e.onChange(i.fileList),fileList:e.value,children:[t.jsx("p",{className:"ant-upload-drag-icon",children:t.jsx(K,{})}),t.jsx("p",{className:"ant-upload-text",children:"Click or drag file to this area to upload"})]})}),(a==null?void 0:a.files)&&t.jsx("p",{className:"text-sm text-red-600 mt-1",children:a.files.message})]})]})]}),t.jsx(q,{type:"submit",loading:f,disabled:f,children:"SUBMIT TICKET"})]})})]})}export{ye as default};
